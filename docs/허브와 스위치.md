## 물리계층의 장비: 허브

허브는 여러 호스트를 연결하는 장치로서, 물리계층에 속한다.

물리계층에 속하기 때문에, 중요한점은 목적지가 어딘지 상관없이 쏜다는것이다.

즉, **송신지를 제외한 나머지 호스트에게 무조건적으로 전송한다.**

그러면 본인이 수신지가 아닌 호스트는 데이터링크 계층에 가서 폐기한다.

그리고 허브는 `반이중 통신`을 하게된다. 

`반이중 통신`이란 동시의 송 수신이 불가능한 통신을 의미한다.

이러한 `반이중 통신`을 지원하는 허브의 경우 만약 `동시에 송신`하게 되었을 때 충돌이 발생할 수 있다.

이렇게 충돌이 발생할 수 있는 영역을 `콜리전 도메인`이라고 부른다.

그래서 충돌을 해결하기 위한 프로토콜로 `CSMA/CD(Carrier Sense Multiple Access with Collision Detection)` 이 있다.

해당 프로토콜의 주요핵심은 허브에 송신하기 전, **다른 누군가가 송신하고 있는지 검사**하고(`Carrier Sense`)

이로인해 반이중 통신의 핵심인 동시 송수신 불가를 달성할 수 있으며, 만약 다중 동시접근으로 인한 충돌이 감지될 경우 다른 호스트들과 함께 `일정시간을 대기`한다.


## 데이터링크 계층의 장비: 스위치

스위치는 데이터링크 계층에서 사용되는 네트워크 장비로서 `L2 스위치`라고도 불린다.

이 스위치에는 여러 구멍이 있는데, 이 구멍을 포트라고 부른다. 이 포트관련해서는 `VLAN`내용으로 이어진다.

가장 큰 특징으로는 `전이중 통신`을 지원하는데, 전이중을 달성하기 위해서 상대의 주소를 기억하기 위한 `MAC주소 학습` 및 `테이블`이 준비되어있다.

결국 송 수신지의 `MAC주소`를 알아야 하므로 다음과 같은 `MAC주소 학습`을 가진다.

### 스위치의 MAC주소 학습

만약 하나의 스위치에 4가지 호스트 A, B, C, D가 연결되어있다고 하자.

그리고 A가 C로 스위치를 통해 통신하려 한다고 가정해보자.

`초기에는 스위치에 MAC주소 테이블은 모두 비어`있다.

그리고 MAC주소를 학습하는 과정의 핵심은 `이더넷 프레임 내 송신지의 MAC주소 기억`으로 이루어진다.

이더넷 프레임관련해서는 헤더와 페이로드 그리고 트레일러가 있고, 헤더에는 프리앰블, MAC 송수신지 주소, 타입 혹은 길이비트 가 있고, 트레일러에 CRC 비트가 있다.

여기서 데이터링크 계층에서 필요한 부분을 떼어내기 때문에 (`decapsulation`) 충분히 얻을 수 있다.

그래서 `A -> 스위치`로 넘어갈때, 스위치가 기억하는건 `해당 포트에 MAC주소는 현재 ~~ 입니다.` 라는걸 기억한다.

하지만 아직까지도 현재 수신받을 C에 대한 정보가 없다. 그래서 `플러딩`을 통해 `송신지 포트를 제외한 모든 호스트`에 프레임을 전송한다.

그러면 각 호스트별로 데이터링크 계층에서 필요없다고 판단되면 폐기하고, `자신이 수신지라는것이 파악된다면 응답 신호를 스위치에 전송`한다.

그러면 아까의 MAC주소 학습법에 의해 `C의 MAC주소를 포트와 매핑`한다. 

이런 다음에는 서로 프레임을 주고받을때에는 이제 허브와는 다르게 송신지를 제외한 모든 호스트에게 날릴 필요가 없이 특정 주소에만 날리면된다.
 
여기서 `특정주소로 걸러내는 작업을 필터링`이라고 하고,` 필터링을 거친 포트로 전송하는것을 포워딩`이라고 한다.

마지막으로 MAC주소에서 포트에 매핑되어 있는 MAC주소가 있을 때, 이 포트에서 일정시간동안 프레임을 못받을 시 해당 포트에서 MAC주소를 지워버린다. 이를 `에이징`이라고 한다.

### 스위치의 VLAN과 포트

VLAN은 Virtual LAN의 줄임말로서 한대의 스위치로 가상의 LAN 영역을 분리하는것을 의미한다.

물론 서로다른 VLAN사이에서의 통신이 발생할 수 있는데, 이는 상위계층의 네트워크 장비가 필요하다.

예를들어서 포트 1~20번이 있을때, 1~10번과 11~20을 VLAN으로 분리하면, 1~10번 영역의 브로드케스트는 11~20에 닿지 않는다.

만약 VLAN을 따로 설정하지 않았다면 1번이 브로드케스트를 쐇을때 나머지 2~20 번 모두가 수신하게 될 것이다.

마치 논리적인 개념으로 영역을 분리하는 셈이다.

이를 달성하기 위해 2가지 방법이 있는데, `포트기반 VLAN`과 `MAC기반 VLAN`이 있다.

`포트기반 VLAN`은 말그대로 1대 이상의 스위치에서 포트별로 VLAN을 묶는 방식이다.

그리고 2대이상일 때에는 같은 VLAN에 속하게 하기 위해 또다른 스위치의 포트를 VLAN끼리 연결하는것은 포트낭비이다.

이런 상황일때 `트렁큰 포트`를 통해 두 스위치를 연결하는 방법을 사용하면 포트낭비를 줄일 수 있다.

추가적으로 서로다른 스위치이지만 같은 VLAN에 속할때 어떻게 VLAN정보를 넘기는가? 가 궁금할 수 있는데, 이는 기존 이더넷프레임에 VLAN TAG 정보를 추가로 넘긴다.

또다른 방법으로 `MAC기반 VLAN`은 말 그대로 `MAC주소를 VLAN에 할당`하는 것으로, 어떤 포트인지 관심없게 된다.






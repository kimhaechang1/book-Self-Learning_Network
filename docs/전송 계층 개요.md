## 전송 계층

전송 계층은 아래 레이어인 네트워크의 한계점을 보완하고 응용 계층의 프로세스에 패킷을 전달하는 역할을 수행한다.

IP 프로토콜을 이용하여 IP주소지정과 IP 단편화를 이루는 네트워크 계층은 어디까지나 라우터를 사용하여 최적경로로 빠르게 전송하는 목적이 있다.

즉, 위 목적은 어디까지나 빠르게 전송이지 `신뢰성`있고 `연결지향적` 전송이 아니다.

`신뢰성`은 해당 메세지가 완벽하게 전달되었는지 확인이 가능해야 함을 의미하며 

중간에 손실이나면 재전송도 되어져야 하고, 순서대로 패킷이 수신지에 도달해야 한다.

하지만 `IP`까지는 도착 순서를 보장하기 어렵고, 전달되었는지 확인할 수 없다.

`연결지향적`은 말그대로 송 수신지간에 연결과정을 맺는것을 의미하며,

`IP`의 경우 빠른 전송을 위해 별도의 연결과정없이 수신지로 패킷을 전달한다.

### 응용 계층과의 다리역할을 수행하는 포트

결국 앞선 계층까지를 통해 수신지와 수신자까지 결정지을 수 있지만, 수신자의 장비내의 어떤 프로그램에게 전달할지는 결정짓지 못한다.

이와같이 수신자 내 최종 수신대상 어플리케이션을 구분짓는 정보를 `포트`라고 한다.

### 포트기반 NAT

`NAT(Network Address Translation)`는 사설 IP를 공인 IP로 변경해주는 변환 테이블을 가진 기능이다.

IP계층까지는 포트가 없었으므로 "동일 네트워크내 어떻게 수많은 사설 IP가 하나의 공인 IP로 묶일 수 있지? 구분은 어떻게 하는걸까" 라는 의문이 풀리지 않았다.

여기서 등장하는것이 `NAPT(Network Address Port Translation)`으로 여러 `사설 IP와 포트번호`를 `공인 IP + 포트번호`로 매핑하는 기술이다.
```
예를들어 공인 IP가 1.2.3.4 인 장비에 내부 사설 네트워크를 사용하는 사설 IP 192.168.0.2 과 사설 IP 192.168.0.3 이 있다고 가정하자.

그리고 각각의 현재 통신하려하는 프로세스 포트번호는 6111, 6112라고 가정하자.

즉 192.168.0.2:6111, 192.168.0.3:6112 이다.

IP 1.2.3.4의 입장에서는 N:1 관계로 여러 사설 IP를 매핑하는데, 이 때 사용하는것이 NAPT

그래서 NAPT 장비가 각각의 순서대로 1024, 1025번에 매핑한다 하면

1.2.3.4:1024 -> 192.168.0.2:6111

1.2.3.4:1025 -> 192.168.0.3:6112 로 매핑된다.
```

여기서 GPT 오피셜은 랜덤으로 안쓰는 포트번호를 NAPT를 지원하는 장비에서 매핑해줘서 테이블을 채운다고 한다.

그것을 원치않는 경우 즉, 특정 공인 IP + 포트번호 -> 사설 IP + 프로세스 포트번호 로 고정된 매핑을 하고싶은 경우에는 `포트 포워딩`을 사용하면 된다.

### ICMP

사실 IP 패킷을 통한 전송은 전송이 되었든 말든 신경안쓰고, 중간에 패킷이 유실되든 재전송도 안한다.

이러한 신뢰성없고 비연결지향적인 IP 패킷을 조금은 보완하기 위해서 `ICMP(Internet Control Message Protocol)`이 등장한다.

이는 `IP 패킷의 전송과정에 대한 피드백 메시지`를 얻기 위해 사용하는 프로토콜이다.

물론 이 `ICMP`는 IP 패킷의 신뢰성을 보장하기 위한 장비는 아니라는것을 명심해야 한다.

왜냐하면 `ICMP`도 마찬가지로 패킷이 유실될 가능성이 있기 때문이다.


## 라우팅

네트워크 계층에서 사용하는 장비는 크게 `라우터`와 `L3 스위치`가 있다.

엄밀하게 따지면 `라우터`와 `L3 스위치는` 약간 차이가있으나 거의 동일한 의미로 쓰인다.

`라우팅`은 네트워크 계층에서 패킷의 전달 최적경로를 설정하고 해당 경로상으로 이동시키는것을 의미한다.

### 라우팅 테이블

라우터는 패킷을 목적지까지 전달하기 위해 경로를 담아두는 `라우팅 테이블`이 존재한다.

이러한 라우팅 테이블에는 `수신지 IP주소 및 CIDR(서브넷 마스크)`, `다음 홉 혹은 게이트웨이`, `네트워크 인터페이스` 그리고 `메트릭`이 있다.

수신지 IP주소 및 서브넷 마스크가 의미하는 바는 `패킷의 수신지 IP의 호스트 주소영역대(서브넷 마스크 활용)가 일치하는 패킷`에 대하여

다음 홉 혹은 게이트웨이는 해당 목적지까지는 일단 현재 라우터에서는 `해당하는 호스트로 이동해야 함`을 의미하고

네트워크 인터페이스는 현재 이동하려고 하는 `해당 호스트의 NIC`를 의미하며

메트릭은 `해당경로의 비용`을 의미한다.

```
다음과 같은 라우팅 테이블 내에 한 요소가 있다고 가정해보자

수신지 IP:      192.168.2.0
섭넷 마스크:    255.255.255.0
게이트웨이:     192.168.2.1
인터페이스:     eth0
메트릭:         30

수신지가 192.168.2.0/24 의 네트워크 영역대를 가진 패킷은(192.168.2.1 ~ 192.168.2.254)

인터페이스 eth0을 통해 192.168.2.1의 호스트로 전송한다는 의미이다.
```

그런데 모든 패킷의 수신지주소에 대한 라우팅 정보를 갖고있으면 좋지만 항상 그런것은 아니다.

이럴때에는 기본적으로 패킷을 내보낼 경로를 설정해놓고 해당 경로로 전송하는데, 이때 기본경로를 `디폴트 라우트`라고 한다.

### 정적 라우팅과 동적 라우팅

`정적 라우팅`은 말그대로 어떤 IP/sub-net 어떤 게이트웨이로 라우팅하는 명령어를 치면 된다.

그러면 라우팅 테이블에 해당 정보가 추가된다.

`동적 라우팅`은 정적 라우팅의 경우 해당 경로에 문제가 발생하더라도 스스로 대처할 수 없지만

동적 라우팅은 경로상의 항목이 동적으로 변화하기에 직접 입력할 필요도 없고 장애대응도 어느정도 가능하다.

이를 만족시키기위한 프로토콜이 `라우팅 프로토콜`이다.

라우팅 프로토콜은 크게 `AS 내부`에서 일어나는것을 `IGP`, `AS외부`에서 발생하는것을 `EGP`라고 분류한다.

여기서 `AS`는 동일한 라우팅 정책으로 운용되는 라우팅 집단을 뜻한다.

여기서말하는 라우팅 정책은 최적경로를 선택하는데 해당 프로토콜에 대해서 더욱 세밀하게 조정하거나, 특정 AS에 대한 필터링 사용할지 정하는것을 의미한다.

이들 `AS`집단내의 라우터중에서 `외부와 통신하는 라우터를 ASBR(Autonomous System Boundary Router)라고 지칭`하고 이들을 통해 내부 라우터가 외부와 통신한다.

### IGP: RIP(Routing Information Protocol)

RIP는 `거리벡터` 기반 라우팅 프로토콜이다. 여기서 말하는 거리는 특정 수신지까지 도달하기 위한 홉의 개수가 되며, 홉이 적을수록 메트릭값도 낮아진다.

RIP는 주기적으로 라우팅 테이블을 갱신한다.

### IGP: OSPF(Open Shortest Path First)

OSPF는 `링크상태` 기반 라우팅 프로토콜이다. 

이는 호스트들 사이의 연결관계나 네트워크 상태를 표현한 그래프를 `링크상태 데이터베이스`를 통해 저장한다.

OSPF는 네트워크 구성의 변경이 있을때 마다 변경한다. 

이에 따라 AS내에 소규모 그룹으로 에이리어를 나누어, 같은 에이리어 내의 라우터들끼리만 구성변경시 갱신하고

중간 관계자 라우터를 ABR(Area Border Router)로 두어 두 에이리어를 연결한다.

### EGP: BGP(Border Gageway Protocol)

엄밀하게 따지면 `AS간의 통신이 가능한 프로토콜`을 의미한다. 그래서 `AS 내`의 통신으로도 사용이 가능하다.

그래서 AS 내부에 라우터들끼리의 프로토콜은 `iBGP`, AS(ASBR)간의 프로토콜을 `eBGP`라 분류한다.

그리고 AS간에 정보를 주고받기 위해서는 내부에 최소 한개이상의 `eBGP`가 필요하고, 또 다른 AS의 BGP와 연결되어야 한다.

이런 연결은 BGP 메세지를 주고받음으로서 이루어지고, 이런 연결된 BGP 라우터를 `피어`라고 지칭하며, 연결하는 과정을 `피어링`이라고 한다.

iBGP 프로토콜 간에는 내부 피어라고 하고, eBGP간의 피어를 외부피어라고 한다.
### 대칭키와 비대칭키

구분 기준은 복호화와 암호화에 같은 키를 사용하냐 안하냐의 차이가 있다.

대칭키는 같은키를 사용하는 방식으로서, 평문을 암호화하는데 사용되는 키를 서버 클라이언트간에 같은 것을 사용해야 한다.

같은것을 사용해야 하니까, 그 키를 안전하게 전달하는 방법이 어렵다.

왜냐하면 미리 클라이언트와 서버가 각각 "우리 이 키로 대화합시다"하고 맞춰놓지 않은이상, 대부분의 경우 키를 네트워크상으로 주고받아야 할 텐데,

이는 키에 대해서 누구든 도청이 가능해진다. 애초에 평문을 암호화하는 이유와 다를게 없어진다.

따라서 이를 보완하기 위해 `공개 키 암호화 방식` 이라고 하는 `비대칭키 암호화` 방식이 있다.

이는 기본적으로 암호화와 복호화에 쓰이는 키가 다르고, 각 호스트가 사용하는 개인키가 있고, 송신자는 평문을 공개키로 암호화하는 방식이다.

공개키는 말그대로 공개되어있는 키로서, 암호화 할때만 사용되기에 공개키로 복호화는 안된다.

```
A와 B가 각각 개인키를 들고 있고, A는 B를 위한 공개키, B는 A를 위한 공개키가 있다는 전제하에

A 가 송신할때에는 평문을 B의 공개키로 암호화하고, B는 자신의 개인키 (B키)로 복호화 할 수 있다.

B 가 송신할때에는 평문을 A의 공개키로 암호화하고, A는 자신의 개인키 (A키)로 복호화 할 수 있다.
```

결국 공개키에 대해서 안전하게 공유할 수 있으므로 보안에 있어서는 비대칭키 방식이 좋지만, 그 만큼 시간과 부하가 발생한다.

그래서 대칭키 방식과 비대칭키 방식을 섞어서 사용하는 경우가 많다.

대칭키 방식의 문제점이 키를 안전하게 전달하기 힘들었다면, 공개키 방식과 함께 사용하면 대칭키를 공개키로 암호화 하고, 개인키로 복호화 하는 방식으로 전달할 수 있다.

이 때 대칭키를 비대칭키와 섞어서 사용할 때, 해당 키를 `세션키` 라고 한다.

### 인증서

인증서는 인증기관 (CA)에서 부터 발급받아서 공개키의 유효성을 검증하는데 사용된다.

인증서에는 크게 인증서 내용부분과 서명으로 나눠져 있다.

서명은 인증서 내용에 있는 해싱방법으로 해싱한 후 CA 개인키로 암호화한 결과물이다.

검증방법으론 다음과 같다.

```
서버로 부터 인증서를 받는다. 이 인증서에는 인증서내용과 서명이 들어가있다.

서명을 CA 공개키로 복호화한다. 이 때 사용되는 CA 공개키는 보통 운영체제 설치시 혹은 브라우저가 갖고있다고 함

CA 서명을 복호화된 결과와

클라이언트가 직접 해싱하나 결과(== 인증서 내용에 담겨있음)를 비교하여 검증한다.
```

## 이 모든건 HTTPS를 위한 빌드업

<a href="https://sunrise-min.tistory.com/entry/TLS-Handshake%EB%8A%94-%EC%96%B4%EB%96%BB%EA%B2%8C-%EC%A7%84%ED%96%89%EB%90%98%EB%8A%94%EA%B0%80">TLS HandShake</a>

대칭키, 비대칭키, 세션키, 인증서 이 모든것은 `HTTPS 프로토콜`에서 사용하는 `TLS HandShake`를 이해하기 위해서이다.

TCP 3-Way-HandShake를 통해 길을 열어준 다음 TLS HandShake가 시작된다.
![alt text](image.png)
<p>출처: https://www.geeksforgeeks.org/transport-layer-security-tls-handshake/</a>

- ClientHello

    - 클라이언트 입장에서 지원하는 TLS 버전, 암호화방식, 클라이언트 난수, 세션ID등을 포함시킨다.

        - 이 때 암호화방식과 해시함수를 적어놓은것을 `암호 스위트`라고 한다.

        - 초기 헨드쉐이크에서는 세션ID가 없다. 만약 기존에 클라이언트가 세션ID가 있다면, 서버에서는 검증한다.

- ServerHello

    - 클라이언트가 제안한것들 중에 선택하고, 서버 난수를 전달한다.

- Certificate

    - CA인증서를 보내는것이다.

- Server Key Exchange

    - 서버에서 사용하는 공개키를 클라이언트에게 전송한다.

- Client Key Exchange

    - 서버에서 제공받은 공개키를 사용해서 평문 암호화에 사용할 대칭키(세션키)를 생성하고 전송한다.

- ChangeCipherSpec

    - 서로가 교환할 인증정보를 모두 마쳤으므로 각각이 갖고있는 대칭키를 통해 평문을 암호화하여 전송될 준비를 마쳤다는 메세지를 보내는과정


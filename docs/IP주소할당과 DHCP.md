## 네트워크 주소와 호스트 주소

일반적으로 IPv4의 옥텟을 기준으로 네트워크를 나타내는 `네트워크 주소`와 호스트들에게 의미가 부여되는 `호스트 주소`로 나뉜다.

여기서 이 기준을 나누는 방법이 과거에는 `클래스 풀` 기법을 사용하였고

`클래스 풀`기법이 생각보다 주소가 낭비되는 경우가 많아서 `서브넷 마스크`를 활용하여 좀 더 유연한 `클래스 리스`기법을 사용한다.

### 클래스풀 기법

네트워크와 호스트주소의 비율에 따라 A, B, C 클래스로 나누어 관리한다.

주의할 점이라면 호스트주소가 전부 0인 것은 `네트워크 주소`로 사용되고 반대로 1인것은 `브로드 케스트`용 주소로 활용되기에, 호스트 개수는 이 두개를 빼놓고 생각해야한다.

- A 클래스: `네트워크주소를 8비트, 호스트주소를 24비트`를 차용하고, 네트워크 주소 `맨앞 비트를 0`으로 설정한다. 그래서 네트워크는 `2^7`개 사용가능하고 호스트는 `2^24-2` 개 사용가능하다.

- B 클래스: `네트워크주소를 16비트, 호스트주소를 16비트`를 차용하고, 네트워크 주소 `맨앞 비트를 10`으로 설정한다. 그래서 네트워크는 `2^14`개 사용가능하고 호스트는 `2^16-2` 개 사용가능하다.

- C 클래스: `네트워크주소를 24비트, 호스트주소를 8비트`를 차용하고, 네트워크 주소 `맨앞 비트를 110`으로 설정한다. 그래서 네트워크는 `2^21`개 사용가능하고 호스트는 `2^8-2` 개 사용가능하다.

즉, A클래스는 호스트 약 1600만개, B클래스는 약 6만개, C클래스는 254개 인 셈

그런데 고작 255개? 혹은 C클래스를 조금넘는 수치의 호스트가 존재한다고 해서 B클래스급을 불러들이기엔 낭비가 심하다

이래서 고안해낸것이 `서브넷 마스크`를 활용한 `클래스리스` 기법이다.

### 클래스리스 기법

먼저 `서브넷 마스크`란 네트워크 주소를 위한 비트는 1, 호스트 주소를 위한 비트는 0으로 설정한 비트 마스킹용 비트열을 의미한다.

그래서 어떤 주소의 호스트 영역대를 구하고싶을 때에는 CIDR 숫자를 통해 네트워크 영역의 개수를 구하고 비트열 `AND`연산의 결과를 통해 구할 수 있다.

여기서 `CIDR`이란 서브넷 마스크에서 네트워크 주소의 길이를 `/`와 함께 표시하는 방법이다.

```
예를들어 다음과 같은 주소가 있다고 가정해보자.

192.168.0.2/25

여기서 CIDR 표기법으로 표시된 25는 곧 네트워크 길이가 25라는 의미가 된다.

서브넷 마스크를 포함하여 둘을 비트열로 표현하자면

11000000 10101000 00000000 00000000 : 서브넷 마스크
11111111 11111111 11111111 10000000 : 192.168.0.2

이를 AND 연산하면

11000000 10101000 00000000 00000000 : 192.168.0.0

이 된다.

여기서 호스트용 주소는 7개의 비트열이므로 0~128이고 

0은 네트워크 주소용, 128은 브로드케스트용 주소이므로

브로드케스트용 주소 192.168.0.1 ~ 192.168.0.127 의 호스트 주소 영역대를 가지게 된다.
```

### 사설 IP와 NAT

가정집 공유기나 라우터를 통해 `외부로 공개되지 않는 네트워크` 영역대에서 배정받은 IP를 `사설 IP`라고 부른다.

이러한 사설 IP는 다음과같은 값을 사설 IP의 영역대로 사용하기로 약속되어 있다.

```
10.0.0.0/8

172.16.0.0/12

192.168.0.0/16
```

반대로 `외부 네트워크 망과 연결`된 부분에서 사용하는 IP는 `공인 IP`라고 한다.

여기서 문제점이 발생한다.

```
만약 사설 네트워크 1에서 호스트 A 주소 192.168.0.2 이고

사설 네트워크 2에서 호스트 B 주소가 192.168.0.2 이다.

여기서 A -> B 로의 통신은 어떻게 되는걸까? 둘은 사설 IP가 동일하다.
```

이럴때 사용하는것이 `NAT(Network Address Translation)` 기술이다.

`NAT`은 `공인 IP`를 `사설 IP`로 변경하고 그 반대도 적용시켜주는 기술이다.

그래서 위의 예시가 NAT을 거치게 되면

```
A -> 외부망: A에서 생겨난 패킷이 외부망으로 나갈때에는 A의 사설주소는 공인 IP주소로 바뀐다.

외부망 -> B: 수신지는 보통 B의 공인 IP주소로 기억하고 있을테니 수신지의 공인 IP주소를 통해 B 호스트를 특정한다.
```

### DHCP (Dynamic Host Configuration Protocol)

IP주소는 정적으로 할당해줄 수 있지만, 동적으로 할당받아 사용할 수 있다.

이때 동적으로 남는 IP를 일정기간 대여해주는 프로토콜을 `DHCP(Dynamic Host Configuration Protocol)`이라고 부른다.

이러한 DHCP 프로토콜을 통해 IP를 배정받는 과정에는 배정받고자 하는 호스트와 `DHCP 서버`간에 메세지를 주고받음으로서 이루어진다.

`DHCP 서버`의 역할은 주로 라우터가 수행한다.

DHCP는 총 4가지 방식으로 통신한다.

1. `DHCP Discover`: DHCP서버를 찾기위해 호스트가 속한 네트워크 내에 브로드케스트로 DHCP Discover 메세지를 전송한다. 이때 송신지 주소는 아직 배정받지 못함을 의미하는 `0.0.0.0/8`이 된다.

2. `DHCP Offer`: DHCP서버로부터 IP주소, 서브넷 마스크, 임대 기간 등을 제안받는다.

3. `DHCP Request`: 또다시 브로드케스트로 전송하며 호스트가 제안받은 주소를 써도되는지 응답하는 과정이다.

4. `DHCP ACK`: 마지막 최종승인이다.

즉 다시말해 2번의 클라이언트로 부터 브로드캐스트가 이뤄지고 Discover, Offer, Request, ACK가 끝나고나면 호스트는 일정 대여기간이 담긴 주소를 받게된다.
